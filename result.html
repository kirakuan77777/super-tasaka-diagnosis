<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>診断結果 - スーパータサカ診断</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <div id="chat-box">
      <h1>診断結果</h1>
      <div id="result-container">
        <p>診断結果を読み込み中...</p>
      </div>
      <button onclick="location.href='index.html'">トップページに戻る</button>
    </div>
  </div>
  <script>
    // GASのエンドポイント
    const GAS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbynlLoWDmKmJctOKq_VPfmcPA83WRBqhR92lwvjiDPGyuuYlpDfNyjMa8cgmRNWCnrx/exec';

    // URLからユーザー名を取得
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('user');

    // 結果を取得して表示
    async function fetchResult() {
      try {
        // スコア計算シートから結果を取得
        const response = await fetch(`${GAS_ENDPOINT}?action=getResult&userId=${encodeURIComponent(userId)}`, {
          mode: 'no-cors',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        const data = await response.json();
        
        if (data.success && data.result) {
          document.getElementById('result-container').innerHTML = `
            <p class="user-name">${userId}さんの診断結果</p>
            <div class="result-content">
              <p class="score">合計スコア: ${data.result}点</p>
              <p class="result-message">${getResultMessage(data.result)}</p>
            </div>
          `;
        } else {
          document.getElementById('result-container').innerHTML = `
            <p class="error-message">診断結果の取得に失敗しました。</p>
            <p class="error-detail">スプレッドシートの「診断ツール」メニューから「スコア集計実行」を実行してください。</p>
          `;
        }
      } catch (error) {
        console.error('結果取得エラー:', error);
        document.getElementById('result-container').innerHTML = `
          <p class="error-message">診断結果の取得に失敗しました。</p>
          <p class="error-detail">スプレッドシートの「診断ツール」メニューから「スコア集計実行」を実行してください。</p>
        `;
      }
    }

    // スコアに応じたメッセージを返す
    function getResultMessage(score) {
      if (score <= 88) {
        return 'あなたは慎重派です。物事をじっくりと考えて行動するタイプです。';
      } else if (score <= 176) {
        return 'あなたはバランス型です。状況に応じて柔軟に対応できるタイプです。';
      } else {
        return 'あなたは積極派です。新しいことにチャレンジすることを好むタイプです。';
      }
    }

    if (userId) {
      fetchResult();
    } else {
      document.getElementById('result-container').innerHTML = `
        <p class="error-message">ユーザー情報が見つかりませんでした。</p>
      `;
    }
  </script>
</body>
</html>
